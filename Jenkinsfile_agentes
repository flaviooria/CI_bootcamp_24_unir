pipeline {
    agent none

    environment {
        PYTHONPATH = '.'
        PATH_VENV = 'ci_venv/bin'
    }

    stages {
        stage('Checkout code') {
            agent {
                label 'dev'
            }

            steps {
                sh 'whoami'
                sh 'hostname'
                sh 'echo $WORKSPACE'
            }
        }

        stage('List directories') {
            agent {
                label 'dev'
            }

            steps {
                sh 'ls -la'
            }
        }

        stage('Create virtualenv') {
            agent {
                label 'dev'
            }

            steps {
                sh 'whoami'
                sh 'hostname'
                sh 'echo $WORKSPACE'


                sh 'python3 -m venv ci_venv'

                sh '. $WORKSPACE/$PATH_VENV/activate'

                sh '$WORKSPACE/$PATH_VENV/pip install -r requirements.txt'
            }
        }
    }

}